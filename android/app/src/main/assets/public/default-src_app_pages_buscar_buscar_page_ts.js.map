{"version":3,"file":"default-src_app_pages_buscar_buscar_page_ts.js","mappings":"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","sources":["./src/app/pages/buscar/buscar.page.ts"],"sourcesContent":["import { Component, ElementRef, HostBinding, Input, OnInit, ViewChild } from '@angular/core';\nimport { MisProductosModel } from 'app/models/misproductos.model';\nimport { Observable, Subscription, merge } from 'rxjs';\nimport { DataStore } from 'app/shell/data-store';\nimport { FirebaseService } from 'app/services/firebase.service';\nimport { ModalController } from '@ionic/angular';\nimport { ActivatedRoute } from '@angular/router';\nimport { formatNumber } from '@angular/common';\nimport { ProductosModel } from 'app/models/buscar.model';\nimport { DetallesPage } from 'app/pages/detalles/detalles.page';\nimport { CarritoService } from 'app/services/carrito.service';\n\n@Component({\n  selector: 'app-buscar',\n  templateUrl: './buscar.page.html',\n  styleUrls: [\n    './styles/buscar.page.scss',\n    './styles/buscar.shell.scss',\n    './styles/buscar.responsive.scss'\n  ]\n})\nexport class BuscarPage implements OnInit {\n  // Data passed in by componentProps\n  @Input() titulo: string;\n  @Input() categoriaId: string;\n  @Input() tiendaId: string;\n\n  searchQuery = '';\n  subscriptions: Subscription;\n  segmentValue = '';\n  productos: Array<MisProductosModel>;\n  productosList: Array<MisProductosModel>;\n  filtered: Array<MisProductosModel>;\n  productosDataStore: DataStore<Array<MisProductosModel>>;\n  stateSubscriptionProductos: Subscription;\n  cart = [];\n  products = [];\n\n  @HostBinding('class.is-shell') get isShell() {\n    return (this.productos) ? true : false;\n  }\n\n  productoSearch: string;\n\n  @ViewChild('detalles', { static: false, read: ElementRef }) fab: ElementRef;\n\n  constructor(\n    public firebaseService: FirebaseService,\n    private modalCtrl: ModalController,\n    private route: ActivatedRoute,\n    private cartService: CarritoService\n  ) { }\n\n  ngOnDestroy(): void {\n    // this.stateSubscriptionProductos.unsubscribe();\n  }\n\n  ngOnInit() {\n    this.titulo = \"Buscar\";\n  }\n\n  searchList() {\n    const query = (this.searchQuery && this.searchQuery !== null) ? this.searchQuery : '';\n    const dataSource: Observable<Array<MisProductosModel>> = this.firebaseService.getProductosDataSourceSearch(this.categoriaId, this.tiendaId, query);\n    const dataStore: DataStore<Array<MisProductosModel>> = this.firebaseService.getProductosStoreSearch(dataSource);\n    this.productosDataStore = dataStore;\n\n    if (this.stateSubscriptionProductos)\n      this.stateSubscriptionProductos.unsubscribe();\n    this.stateSubscriptionProductos = merge(\n      this.productosDataStore.state,\n    ).subscribe(\n      (state) => {\n        state.forEach(element => {\n          var presentacionTxt = '';\n          var valorUnidadTxt = '';\n          if (element != null) {\n            element.descuentoPorc = 0;\n            var hoy: string = new Date().toISOString().substring(0, 10);\n            var desde: string = element.desde == \"\" ? hoy : element.desde;\n            var hasta: string = element.hasta == \"\" ? hoy : element.hasta;\n            if (element.descuento > 0 && hoy >= desde && hoy <= hasta) {\n              element.descuentoPorc = element.descuento;\n              element.descuentoVlr = element.precio;\n              element.precioVlr = (element.precio * (1.0 - element.descuento));\n            }\n            else {\n              element.descuentoVlr = 0;\n              element.precioVlr = element.precio;\n            }\n            if (element.cantidad > 1) {\n              presentacionTxt = presentacionTxt + element.cantidad + ' unidades de ' + element.presentacion + ' ' + element.unidad + ' c/u'\n              valorUnidadTxt = element.precioVlr / element.cantidad + ' x un';\n            }\n            else {\n              presentacionTxt = presentacionTxt + element.presentacion + ' ' + element.unidad\n              valorUnidadTxt = formatNumber(Number((element.precioVlr / element.presentacion)), 'en-US', '1.0-2') + ' x ' + element.unidad;\n            }\n            element.presentacionTxt = presentacionTxt + ' ($' + valorUnidadTxt + ')';\n          }\n        });\n\n        this.productos = state;\n        this.productosList = state;\n      },\n      (error) => console.log(error),\n      () => console.log('stateSubscriptionProductos completed')\n    );\n  }\n\n  closeModal() {\n    this.modalCtrl.dismiss();\n  }\n\n  ionViewWillLeave() {\n    // this.subscriptions.unsubscribe();\n  }\n\n  async openDetalleBuscar(producto: ProductosModel) {\n    let modal = await this.modalCtrl.create({\n      component: DetallesPage,\n      cssClass: 'cart-modal',\n      componentProps: {\n        'producto': producto\n      }\n    });\n    modal.onWillDismiss().then(() => {\n    });\n    modal.present();\n  }\n\n\n\n\n  getTotal() {\n    return this.cart.reduce((i, j) => i + j.precioVlr * j.amount, 0);\n  }\n\n  close() {\n    this.modalCtrl.dismiss();\n  }\n\n  checkout() {\n\n  }\n\n\n}\n"],"names":["Component","ElementRef","HostBinding","Input","ViewChild","merge","FirebaseService","ModalController","ActivatedRoute","formatNumber","DetallesPage","CarritoService","BuscarPage","constructor","firebaseService","modalCtrl","route","cartService","isShell","productos","ngOnDestroy","ngOnInit","titulo","searchList","query","searchQuery","dataSource","getProductosDataSourceSearch","categoriaId","tiendaId","dataStore","getProductosStoreSearch","productosDataStore","stateSubscriptionProductos","unsubscribe","state","subscribe","forEach","element","presentacionTxt","valorUnidadTxt","descuentoPorc","hoy","Date","toISOString","substring","desde","hasta","descuento","descuentoVlr","precio","precioVlr","cantidad","presentacion","unidad","Number","productosList","error","console","log","closeModal","dismiss","ionViewWillLeave","openDetalleBuscar","producto","modal","create","component","cssClass","componentProps","onWillDismiss","then","present","getTotal","cart","reduce","i","j","amount","close","checkout","args","static","read","selector","template"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}