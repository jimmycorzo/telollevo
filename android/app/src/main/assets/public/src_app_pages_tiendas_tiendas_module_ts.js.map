{"version":3,"file":"src_app_pages_tiendas_tiendas_module_ts.js","mappings":"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","sources":["./src/app/pages/tiendas/tiendas-routing.module.ts","./src/app/pages/tiendas/tiendas.module.ts","./src/app/pages/tiendas/tiendas.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { TiendasPage } from './tiendas.page';\n\nconst routes: Routes = [\n    {\n        path: '',\n        component: TiendasPage,\n    }\n];\n\n@NgModule({\n    imports: [RouterModule.forChild(routes)],\n    exports: [RouterModule],\n})\nexport class TiendasPageRoutingModule { }\n","import { CommonModule } from '@angular/common';\nimport { ComponentsModule } from 'app/components/components.module';\nimport { IonicModule } from '@ionic/angular';\nimport { Routes } from '@angular/router';\nimport { NgModule } from '@angular/core';\nimport { TiendasPage } from './tiendas.page';\nimport { TiendasPageRoutingModule } from './tiendas-routing.module';\nimport { FirebaseService } from 'app/services/firebase.service';\n// import { InAppBrowser } from '@awesome-cordova-plugins/in-app-browser/ngx';\n\nconst tiendasRoutes: Routes = [\n  {\n    path: '',\n    component: TiendasPage\n  }\n];\n\n@NgModule({\n  imports: [\n    IonicModule,\n    CommonModule,\n    TiendasPageRoutingModule,\n    ComponentsModule,\n  ],\n  declarations: [TiendasPage],\n  providers: [\n    FirebaseService,\n    // InAppBrowser\n  ]\n})\nexport class TiendasPageModule { }\n","import { Component, OnInit, OnDestroy, HostBinding, ViewChild, ElementRef } from '@angular/core';\nimport { FormGroup, FormControl } from '@angular/forms';\nimport { ModalController, IonRouterOutlet } from '@ionic/angular';\nimport { ActivatedRoute, Params, Router } from '@angular/router';\n\nimport { Observable, ReplaySubject, Subscription, merge } from 'rxjs';\nimport { switchMap, map } from 'rxjs/operators';\n\nimport { TiendasModel } from 'app/models/tiendas.model';\nimport { DataStore, ShellModel } from 'app/shell/data-store';\nimport { FirebaseService } from 'app/services/firebase.service';\n\nimport { CarritoService } from 'app/services/carrito.service';\nimport { CarritoPage } from 'app/pages/carrito/carrito.page';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { BuscarPage } from 'app/pages/buscar/buscar.page';\n\n@Component({\n  selector: 'app-tiendas',\n  templateUrl: './tiendas.page.html',\n  styleUrls: [\n    './styles/tiendas.page.scss',\n    './styles/tiendas.shell.scss',\n    './styles/tiendas.responsive.scss'\n  ]\n})\nexport class TiendasPage implements OnInit, OnDestroy {\n  rangeForm: FormGroup;\n  searchQuery: string;\n  showAgeFilter = false;\n  categoriaId: string;\n  categoria: string;\n\n  searchSubject: ReplaySubject<any> = new ReplaySubject<any>(1);\n  searchFiltersObservable: Observable<any> = this.searchSubject.asObservable();\n\n  tiendasDataStore: DataStore<Array<TiendasModel>>;\n  stateSubscription: Subscription;\n\n  // Use Typescript intersection types to enable docorating the Array of firebase models with a shell model\n  // (ref: https://www.typescriptlang.org/docs/handbook/advanced-types.html#intersection-types)\n  items: Array<TiendasModel> & ShellModel;\n\n  @HostBinding('class.is-shell') get isShell() {\n    return (this.items && this.items.isShell) ? true : false;\n  }\n\n  cart = [];\n  products = [];\n  cartItemCount: BehaviorSubject<number>;\n\n  @ViewChild('cart', { static: false, read: ElementRef }) fab: ElementRef;\n\n  constructor(\n    public router: Router,\n    public firebaseService: FirebaseService,\n    public modalController: ModalController,\n    private route: ActivatedRoute,\n    private routerOutlet: IonRouterOutlet,\n    private cartService: CarritoService,\n    private modalCtrl: ModalController\n  ) { }\n\n  ngOnDestroy(): void {\n    this.stateSubscription.unsubscribe();\n  }\n\n  ngOnInit() {\n    this.route.params.subscribe(\n      (params: Params) => {\n        this.categoriaId = params.categoriaId;\n        this.categoria = params.categoria;\n      }\n    );\n\n    this.products = this.cartService.getProducts();\n    this.cart = this.cartService.getCart();\n    this.cartItemCount = this.cartService.getCartItemCount();\n\n    this.searchQuery = '';\n\n    this.rangeForm = new FormGroup({\n      dual: new FormControl({ lower: 1, upper: 100 })\n    });\n\n    this.route.data.subscribe(\n      (resolvedRouteData) => {\n\n        const dataSource: Observable<Array<TiendasModel>> = this.firebaseService.getTiendasDataSource(this.categoriaId);\n\n        const dataStore: DataStore<Array<TiendasModel>> = this.firebaseService.getTiendasStore(this.categoriaId, dataSource);\n\n        this.tiendasDataStore = dataStore;\n\n        // We need to avoid having multiple firebase subscriptions open at the same time to avoid memory leaks\n        // By using a switchMap to cancel previous subscription each time a new one arrives,\n        // we ensure having just one subscription (the latest)\n        const updateSearchObservable = this.searchFiltersObservable.pipe(\n          switchMap((filters) => {\n            const filteredDataSource = this.firebaseService.searchTiendas(\n            );\n            // Send a shell until we have filtered data from Firebase\n            const searchingShellModel = [\n              new TiendasModel(),\n              new TiendasModel()\n            ];\n            // Wait on purpose some time to ensure the shell animation gets shown while loading filtered data\n            const searchingDelay = 400;\n\n            const dataSourceWithShellObservable = DataStore.AppendShell(filteredDataSource, searchingShellModel, searchingDelay);\n\n            return dataSourceWithShellObservable.pipe(\n              map(filteredItems => {\n                // Just filter items by name if there is a search query and they are not shell values\n                if (filters.query !== '' && !filteredItems.isShell) {\n                  const queryFilteredItems = filteredItems.filter(item =>\n                    item.tienda.toLowerCase().includes(filters.query.toLowerCase()\n                    ));\n                  // While filtering we strip out the isShell property, add it again\n                  return Object.assign(queryFilteredItems, { isShell: filteredItems.isShell });\n                } else {\n                  return filteredItems;\n                }\n              })\n            );\n          })\n        );\n\n        // Keep track of the subscription to unsubscribe onDestroy\n        // Merge filteredData with the original dataStore state\n        this.stateSubscription = merge(\n          this.tiendasDataStore.state,\n          updateSearchObservable\n        ).subscribe(\n          (state) => {\n            state.forEach(element => {\n              if (element != null && element.mishorarios != null) {\n                const hora = String(\"0\" + new Date().getHours()).slice(-2) + ':' + String(\"0\" + new Date().getMinutes()).slice(-2);\n                element.cerrada = !(hora >= element.mishorarios.desde && hora <= element.mishorarios.hasta);\n                // element.mishorarios.desde = new Date('1968-11-16T' + element.mishorarios.desde).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n                // element.mishorarios.hasta = new Date('1968-11-16T' + element.mishorarios.desde).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n              }\n              else\n                element.cerrada = false;\n            });\n            this.items = state;\n            console.log('Items de tiendas', state);\n          },\n          (error) => console.log(error),\n          () => console.log('stateSubscription completed')\n        );\n      },\n      (error) => console.log(error)\n    );\n  }\n\n  searchList() {\n    this.searchSubject.next({\n      lower: this.rangeForm.controls.dual.value.lower,\n      upper: this.rangeForm.controls.dual.value.upper,\n      query: this.searchQuery\n    });\n  }\n\n\n  addToCart(product) {\n    this.cartService.addProduct(product);\n  }\n\n\n  async openCart() {\n\n    let modal = await this.modalCtrl.create({\n      component: CarritoPage,\n      cssClass: 'cart-modal'\n    });\n    modal.onWillDismiss().then(() => {\n      this.fab.nativeElement.classList.remove('animated', 'bounceOutLeft')\n    });\n    modal.present();\n  }\n\n  async openSearch(titulo: string, categoriaId: string, tiendaId: string) {\n\n    let modal = await this.modalCtrl.create({\n      component: BuscarPage,\n      cssClass: 'cart-modal',\n      componentProps: {\n        'titulo': titulo,\n        'categoriaId': categoriaId,\n        'tiendaId': tiendaId\n      }\n    });\n    modal.onWillDismiss().then(() => {\n      this.fab.nativeElement.classList.remove('animated', 'bounceOutLeft')\n    });\n    modal.present();\n  }\n\n  closeModal() {\n    this.modalCtrl.dismiss();\n  }\n\n  // openTienda(tiendaId: string, tienda: string) {\n  //   if (this.categoriaId != 'colegios')\n  //     this.router.navigate(['/clases/', tiendaId, tienda], { replaceUrl: true });\n  // }\n\n}\n"],"names":["Component","HostBinding","ViewChild","ElementRef","FormGroup","FormControl","ModalController","IonRouterOutlet","ActivatedRoute","Router","ReplaySubject","merge","switchMap","map","TiendasModel","DataStore","FirebaseService","CarritoService","CarritoPage","BuscarPage","TiendasPage","constructor","router","firebaseService","modalController","route","routerOutlet","cartService","modalCtrl","searchSubject","asObservable","isShell","items","ngOnDestroy","stateSubscription","unsubscribe","ngOnInit","params","subscribe","categoriaId","categoria","products","getProducts","cart","getCart","cartItemCount","getCartItemCount","searchQuery","rangeForm","dual","lower","upper","data","resolvedRouteData","dataSource","getTiendasDataSource","dataStore","getTiendasStore","tiendasDataStore","updateSearchObservable","searchFiltersObservable","pipe","filters","filteredDataSource","searchTiendas","searchingShellModel","searchingDelay","dataSourceWithShellObservable","AppendShell","filteredItems","query","queryFilteredItems","filter","item","tienda","toLowerCase","includes","Object","assign","state","forEach","element","mishorarios","hora","String","Date","getHours","slice","getMinutes","cerrada","desde","hasta","console","log","error","searchList","next","controls","value","addToCart","product","addProduct","openCart","modal","create","component","cssClass","onWillDismiss","then","fab","nativeElement","classList","remove","present","openSearch","titulo","tiendaId","componentProps","closeModal","dismiss","args","static","read","selector","template"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}